---
title: "Getting Started in ggplot"
institute: "Department of Political Science at Georgia State University"
author: "Josh Allen"
date: "2022-08-29"
format:
  revealjs:
   theme: "allen.scss"
   transition: fade
   progress: true
   multiplex: false
   preview-links: true
   hide-inactive-cursor: true
   highlight-style: printing
   chalkboard:
    theme: whiteboard
    boardmarker-width: 4
    buttons: true
    pause: true
knitr:
  opts_chunk:
    dev: "ragg_png"
    retina: 1
    dpi: 200
execute:
  freeze: auto
  echo: true
  fig-width: 5
  fig-height: 6
---
```{r setup, include = F, warnings = FALSE}

pacman::p_load("tidyverse", "AllenMisc", "countrycode", "MetBrewer", "scico", "colorspace", "gapminder", "sf",  install = FALSE)


gapminder = filter(gapminder, !continent == "Oceania")


clrs <- met.brewer(name = "Demuth")
clrs_lt <- lighten(clrs, 0.9)

graph_dat = datasauRus::datasaurus_dozen

penguins = palmerpenguins::penguins |> tidyr::drop_na()


#coastline = read_sf("data/ME-GIS/Coastline2.shp")
#contours = read_sf("data/ME-GIS/Contours_18.shp")
#rivers = read_sf("data/ME-GIS/Rivers.shp")
#lakes = read_sf("data/ME-GIS/Lakes.shp")
#forests = read_sf("data/ME-GIS/Forests.shp")
#mountains = read_sf("data/ME-GIS/Mountains_Anno.shp")
#placenames = read_sf("data/ME-GIS/Combined_Placenames.shp")
#cities = read_sf("data/ME-GIS/Cities.shp")
#roads = read_sf("data/ME-GIS/Roads.shp")
#towers_keeps =  read_sf("data/ME-GIS/Towers_and_Keeps.shp")

```



## Where We Have Been


```{r out.width = "60%" }
#| output-location: column
plot(penguins$bill_length_mm,
   penguins$body_mass_g,
   xlab = "Bill Length(mm)",
   ylab = "Body Mass(g)")
   abline(lm(body_mass_g~bill_length_mm, data = penguins))
```

:::{.notes}
We have seen how to make plots in base R they take this general form 

:::


## Expanding What We Know{.scrollable}


```{r echo = TRUE, eval = FALSE}
par(mfrow = c(2,2))
plot(penguins$bill_length_mm,
        penguins$body_mass_g,
    xlab = "Bill Length(mm)",
   ylab = "Body Mass(g)")
hist(penguins$bill_length_mm,
  xlim = c(30, 60))
plot(density(penguins$bill_length_mm))
plot(penguins$bill_length_mm,
    penguins$body_mass_g,
    xlab = "Bill Length(mm)",
    ylab = "Body Mass(g)")
abline(lm(body_mass_g~bill_length_mm, data = penguins))
```


```{r echo = FALSE}
#| layout-ncol: 2
plot(penguins$bill_length_mm,
        penguins$body_mass_g,
    xlab = "Bill Length(mm)",
   ylab = "Body Mass(g)")
hist(penguins$bill_length_mm,
  xlim = c(30, 60))
plot(density(penguins$bill_length_mm))
plot(penguins$bill_length_mm,
    penguins$body_mass_g,
    xlab = "Bill Length(mm)",
    ylab = "Body Mass(g)")
abline(lm(body_mass_g~bill_length_mm, data = penguins))
```


:::{.notes}
you have to add something like jpeg("name_of_plot.jpg")

and then add dev.off() at the end

:::


# Research Data Services 


## Our Team 

```{r echo = FALSE}
knitr::include_graphics("figs/rds-team-members.png")
```

:::{.notes}

 Also, we do not have the capacity to provide pre-scheduled frequent software tutoring that is divorced from a specific assignment or software troubleshooting task at hand -- in other words, we are also not generalized software tutors. 
 
 Our one-on-one software assistance is available to help you troubleshoot specific tasks or assignments. If you are seeking generalized software help, we direct you to our live workshops and our recorded workshops to gain the foundational skills for using various analytical software. Then, when or if the time comes that you have targeted software questions or specific issues to tackle related to a course assignment or research project, please feel free to contact us for one-on-one support. 
:::


## Get Ready Badges


```{r echo = FALSE}
knitr::include_graphics("figs/get-ready-badges.png")
```


:::{.notes}


https://research.library.gsu.edu/dataservices/data-ready

These are awesome to share on social media i.e. linkedin which is a good signal
to potential employers that you know this stuff

:::

## How To Get the Badges

```{r echo = FALSE}
knitr::include_graphics("figs/how-to-badge.png")
```


# The Importance of Graphing {background-color="`r clrs[3]`" .white}




## Why visualize your data?

```{r mean-x, eco = TRUE}
mean(graph_dat$x)
```

```{r sd-x, echo = TRUE}
sd(graph_dat$x)
```

```{r mean-y, echo = TRUE}
mean(graph_dat$y)
```



```{r sd-y, echo = TRUE}
sd(graph_dat$y)
```


```{r corr-these-vars, echo = TRUE}
cor(graph_dat$x, graph_dat$y)
```



:::{.notes}



Lets take a quick look at the data that I have loaded in. They look pretty similar for the most part and aren't correlated. 

:::


## The Dino Strikes

<figure>
  <img src="https://raw.githubusercontent.com/andrewheiss/datavizs21.classes.andrewheiss.com/main/static/slides/img/01/DinoSequentialSmaller.gif" alt="Datasaurus Dozen" title="Datasaurus Dozen" width="100%">
  <figcaption><a href="https://www.autodeskresearch.com/publications/samestats" target="_blank">The Datasaurus Dozen</a></figcaption>
</figure>


## Why `ggplot2`?

:::{.callout-note appearance="minimal"}
The transferable skills from ggplot2 are not the idiosyncrasies of plotting syntax, but a powerful way of thinking about visualization, as a way of mapping between variables and the visual properties of geometric objects that you can perceive.

-- Hadley Wickham
:::





## Why `ggplot2`?
:::incremental 

- You have probably heard of it but why use it?

- Once we understand the "grammar" making figures becomes a lot easier

- Tons of organizations use it

- Flexibility
  - Tons ways to customize appearance
  - Lots of functions
  - Lots of extensions 


- Reproducibility 
  - Doesn't require you to remember each input from a drop down menu
  - Defaults to universally usable formats
  - Replaces itself automatically in your directory 

:::

:::{.notes}
ggplot2 is probably one of the most well known and event among many of the staunchest base r users well loved an well used libraries in the R ecosystem.

ggplot2 predates most of the tidyverse and the gg part refers to the grammar of graphics, more on that later. Much like writing a sentence there is a proper grammar to it. Once we understand the rules we can construct lots of different "sentences".

I think an important theme so to say is that once we start to understand R it benefits your workflow because we can simply tweak a few things and then BAM it will just update. If you are a Latex user then bam the same plot just updates. If you are a word user then those benefits are limited but ggplots play nicely with Word. No having to put replace everywhere or screenshot things or working with propietary formats. If you need to you


:::




# The Grammar of Graphics {background-color="`r clrs[3]`" .white}




## Grammar 

:::columns
:::column
"Good grammar is just the first step of creating a good sentence"


- How is the data related to the figure on the right?


:::


:::column


```{r penguin-blank, echo = FALSE}
#| fig-alt: "Here is just a scatter plot with various shapes and sizes. We will fill in the rest as the slides go on"
ggplot(penguins, aes(x = bill_length_mm, y = body_mass_g, shape = species, color = island)) + geom_point(size = 3) + 
  theme_void() + theme(legend.position = "none")
```


:::
:::


## Building the Plot 

:::columns
:::column

*Body Weight of Penguins and Bill Length*

- ***Penguins***

- ***Species***

- ***Island***


:::

:::column

```{r penguin-add-legend, echo = FALSE}
#| fig-alt: "On the right hand side is the legend that denotes what each color and shape represent. Red represents the island Biscoe, Green Represents the island Dream. Light Blue represents the Torgersen Island. The circles represent the Adelie penguins, the triangles represent the Chinstrap penguins, and the squares represent the Gentoo penguins"
ggplot(penguins, aes(x = bill_length_mm, y = body_mass_g, shape = species, color = island)) + geom_point(size = 3) + 
  theme_void()
```


:::
:::

:::{.notes}

I apologize for some weird plotting stuff. I am still working out some kinks with how the presentation is styled. I wanted to try to give the plots and the code the same size on the slides. However that resulted in some weird decisions from quarto
:::





## Building the Plot 
:::columns
:::column

*Body Weight of Penguins and Bill Length*

- ***Penguins***

- ***Species***

- ***Island***


:::

:::column

```{r penguin-add-labs, echo = FALSE}
#| fig-alt: "On the right hand side is the legend that denotes what each color and shape represent. Red represents the island Biscoe, Green Represents the island Dream. Light Blue represents the Torgersen Island. The circles represent the Adelie penguins, the triangles represent the Chinstrap penguins, and the squares represent the Gentoo penguins. The x axis represents bill length in milimeters and the y axis represents body mass in grams "
ggplot(penguins, aes(x = bill_length_mm, y = body_mass_g, shape = species, color = island))  + geom_point(size = 3) + labs(x = "Bill Length(mm)", y = "Body Mass(g)")
```

:::
:::

:::{.notes}
There is a grammar to what is going on 

:::



## Building the Plot

:::columns
:::column

*Body Weight of Penguins and Bill Length*

- ***Penguins***

- ***Species***

- ***Island***

:::



:::column

```{r penguin-full, echo=FALSE}

ggplot(penguins, aes(x = bill_length_mm, y = body_mass_g, shape = species, color = island)) +
  geom_point(size = 3) +
  labs(x = "Bill Length(mm)", y = "Body Mass(g)", title = "The Relationship Between Bill Length and Body Weight",
       subtitle = "By Island and Penguin Species") +
theme_minimal() +
  guides(color = guide_legend(title = "Island"), shape = guide_legend("Species"))  
```


:::
:::



## So How Did We go From?  

::::{.columns}


:::{.column width="50%" .fragment fragment-index=1}

 This

```{r blank-plot-example-this, echo = FALSE, out.width = "90%" }
#| fig-alt: "This is the template that I started with with just points and colors"
ggplot(penguins, aes(x = bill_length_mm, y = body_mass_g, shape = species, color = island, size = species)) + geom_point(size = 3) + 
  theme_void() + theme(legend.position = "none")
```

:::



:::{.column width="50%" .fragment fragment-index=2}

 To This

```{r full-plot-example-this, echo=FALSE, out.width = "90%"}
ggplot(penguins, aes(x = bill_length_mm, y = body_mass_g, shape = species, color = island)) +
  geom_point(size = 3) +
  labs(x = "Bill Length(mm)", y = "Body Mass(g)", title = "The Relationship Between Bill Length and Body Weight",
       subtitle = "By Island and Penguin Species") +
theme_minimal() +
  guides(color = guide_legend(title = "Island"), shape = guide_legend("Species")) 
```

:::
::::
# Making Plots {background-color="`r clrs[3]`" .white}


## The Grammar 
<br>
<table style='width:100%;font-size:14pt;'>
  <tr>
    <th>Component</th>
    <th>Function</th>
    <th>Explanation</th>
  </tr>
  <tr>
    <td><b style='color:#67676;'>Data</b></td>
    <td><code>ggplot(data)</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
    <td>*The raw data that you want to visualise.*</td>
  </tr>
  <tr>
    <td><b style='color:#67676;'>Aesthetics&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></td>
    <td><code>aes()</code></td>
    <td>*Aesthetic mappings between variables and visual properties.*</td>
  <tr>
    <td><b style='color:#67676;'>Geometries</b></td>
    <td><code>geom_*()</code></td>
    <td>*The geometric shapes representing the data.*</td>
  </tr>
  <tr>
    <td><b style='color:#67676;'>Statistics</b></td>
    <td><code>stat_*()</code></td>
    <td>*The statistical transformations applied to the data.*</td>
  </tr>
  <tr>
    <td><b style='color:#67676;'>Scales</b></td>
    <td><code>scale_*()</code></td>
    <td>*Maps between the data and the aesthetic dimensions.*</td>
  </tr>
  <tr>
    <td><b style='color:#67676;'>Coordinate System</b></td>
    <td><code>coord_*()</code></td>
    <td>*Maps data into the plane of the data rectangle.*</td>
  </tr>
  <tr>
    <td><b style='color:#67676;'>Facets</b></td>
    <td><code>facet_*()</code></td>
    <td>*The arrangement of the data into a grid of plots.*</td>
  </tr>
  <tr>
    <td><b style='color:#67676;'>Visual Themes</b></td>
    <td><code>theme()</code> and <code>theme_*()</code></td>
    <td>*The overall visual defaults of a plot.*</td>
  </tr>
</table>
:::{.notes}
This is what it looks like when we start to think of the plot. Each of these are columns in our dataset that we plop into aes. Our x goes in the first slot of aes and the second slot is our y. I typically specify this myself just cuz I like to do that but that is a personal decision. The rest you need to tell ggplot to do 
coordinates Combine the two position aesthetics to produce a 2d position on the plot. The position aesthetics are called x and y, but they might be better called position 1 and 2 because their meaning depends on the coordinate system used. For example, with the polar coordinate system they become angle and radius (or radius and angle), and with maps they become latitude and longitude.
scales  take your data and turn it into something that you can see, like size, colour, position or shape. They also provide the tools that let you interpret the plot: the axes and legends. You can generate plots with ggplot2 without knowing how scales work
:::



## Where do they go?
```{r your-penguin-code, echo = TRUE}
#| code-line-numbers: "2,3,4,5,6,7"
#| output-location: column
ggplot() +
  geom_point(data = penguins,
   aes(
  x = bill_length_mm, 
  y = body_mass_g,
  shape = species, 
  color = island),
  size = 3)
```
:::{.notes}
To actually make the plot you need to specify the columns you want to "map" onto the plot. Map is kind of just the way that it is said in ggplot world. This is just us saying we want these columns in our 
:::


## Plotting Data 


```{r echo = FALSE}
gapminder |>
head(10) |>
knitr::kable(format = "html")


```



## Here is your shell script

```{r skeleton-participants, eval = FALSE, echo = TRUE}
## be sure you have done 
## install.packages("gapminder")
## library(gapminder)

ggplot() +
  geom_point(data = gapminder, mapping = aes(x = gdpPercap, y = lifeExp))

```

:::{.notes}
To help you get your hands dirty I will give y'all a shell script to work with. Press o on your keyboard to navigate to the past slides to help yourself out if you get lost 
:::




## Activity {background-color="`r clrs_lt[3]`"}


- Add color, size, alpha, and shape aesthetics to your graph.


- Be bold be brave! Experiment!


- What happens when you add more than one aesthetic? 



```{r timer-for-them, echo = FALSE}

countdown::countdown(minutes = 5)
```










## How would you make this plot?

```{r gapminder-blue, echo = FALSE}
#| fig-align: center

ggplot(gapminder, aes(x = gdpPercap, y = lifeExp)) + 
  geom_point(color = "blue")


```

:::{.notes}
all we are doing is making each point blue. Should be simple enough. If you are following along please add color = blue where you think it should go!

:::









## 



```{r gapminder-blue-wrong-example, echo = TRUE}
#| code-line-numbers: "5"
#| output-location: column
ggplot() + 
  geom_point(data = gapminder,
   aes(x = gdpPercap,
    y = lifeExp,
    color = "blue"))


```




:::{.notes}
Remember when we do things in aes R will look for a column in our dataset. Importantly R will just looks for things it can do given the scope of the function. So if we put blue into the aes portion of it will plot it. But it will get confused because blue is not a column in our data set. 

:::


##  



```{r use-color-aes-example, echo = TRUE}
#| code-line-numbers: "5"
#| output-location: column


ggplot() +
  geom_point(data = gapminder,
    aes(x = gdpPercap,
        y = lifeExp),
        color = "blue") 



```




:::{.notes}
ggplot will take the color argument inside aes and outside aes. If we specify color inside aes than it will color things by a column in the dataset. If you specify color outside of aes ggplot will make everything that color 

:::



## Same options different stuff

:::columns
:::column


```{r geom-point-gap, echo=FALSE}
ggplot(gapminder ) + 
  geom_point(aes(x = gdpPercap, y = lifeExp),
             color = "blue")

```


:::

:::column

```{r geom-smooth-gap, echo=FALSE}
ggplot(gapminder) + 
  geom_smooth(aes(x = gdpPercap, y = lifeExp),
             color = "blue")

```

:::
:::

:::{.notes}
there we can show the same relationship between two variables in a ton of different ways. there are a ton of geoms that we can use to visualize our data. In this case I am just fitting a loess line through it. 

:::


## What Comes With ggplot

```{r ggplot2-geom-names, echo=FALSE}
## geom_
old_width = options(width = 80)
lsf.str("package:ggplot2") %>% grep("^geom_", ., value = TRUE)
options(width = old_width$width)
```
:::{.notes}
There are many more that we can use too. There are tons of different kinds of plots that we can find for our specific plotting needs that people have written for R I have like an unhealthy obsession with ggridges. I will say geom_sf only gets added when you have the sf package loaded and then 
:::


##

<center>

<iframe src="https://giphy.com/embed/mCClSS6xbi8us" width="480" height="298" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/jeff-goldblum-jurassic-park-jurassicparkedit-mCClSS6xbi8us">via GIPHY</a></p>

:::{.notes}
It's not that certain geoms should never be used with certain kinds its that sometimes it doesnt make a whole lot of sense or we aren't getting the most out of our data visualizations. If it takes the arguments it will plot it.
:::


</center>

## Example(sort of)

:::columns
:::column

```{r dotplot-gapminder, echo=FALSE}

ggplot(gapminder, aes(x = continent, y = lifeExp)) +
  geom_point()


```
:::

:::column


```{r dotplot-penguings, echo = FALSE}
ggplot(penguins, aes(x = species, y = body_mass_g)) +
  geom_point()

```



:::
:::





:::{.notes}
Both times we see that we that ggplot will take the arguments and plot them but we arent really getting a lot of useful information. Boxplots would provide a much provide more info


:::


## Your Turn

:::columns 
:::column

```{r dotplot-gapminder-ref-excercise, echo=FALSE}

ggplot(gapminder, aes(x = continent, y = lifeExp)) +
  geom_point()


```
:::

:::column


```{r echo = FALSE}
ggplot(gapminder, aes(x = continent, y = lifeExp)) +
  geom_boxplot()
```

:::
:::

```{r echo=FALSE}
countdown::countdown(minutes = 2)
```


:::{.notes}
take the graph on the left and change it to the plot on the right. use the ggplot cheatsheet.

:::


## Answer
 


```{r  echo = TRUE}
#| output-location: column

ggplot() +
  geom_boxplot(data = gapminder,
  aes(x = continent, 
  y = lifeExp))

```








## Your Turn Again
#### Hint do not supply a Y value

```{r echo=FALSE, out.width= "80%"}
#| fig-align: center

ggplot(gapminder, aes(x = lifeExp)) +
  geom_histogram()

```

```{r echo = FALSE}


countdown::countdown(minutes = 2)

```

:::{.notes}
Lets make a histogram of lifeExp. In this case we only need to supply one variable to aes. Take exp and look at the distribution through a histogram 
:::




##  


```{r, echo = TRUE}
#| output-location: column
ggplot() +
  geom_histogram( data = gapminder, 
    aes(x = lifeExp))

```




## Your Turn
#### Make This Density Plot filled by continent

```{r echo=FALSE}
#| fig-align: center
#| fig-width: 8

ggplot(gapminder, aes(x = lifeExp, fill = continent)) +
  geom_density()
```

```{r echo=FALSE}

countdown::countdown(minutes = 2)

```

:::{.notes}
Again do not supply a Y column
:::


## 



```{r echo = TRUE}
#| output-location: column

ggplot() +
  geom_density( data = gapminder,
  aes(x = lifeExp,
     fill = continent),
     alpha = 0.75)

```






## Complex graph!


```{r reference-plot, echo=FALSE, fig.width = 10 }

ggplot(gapminder, aes(x = gdpPercap, y = lifeExp, color = continent)) +
  geom_point() +
  geom_smooth() 

```


:::{.notes}
Map wealth to the x-axis, health to the y-axis, add points, color by continent, size by population, scale the x-axis with a log. Please get rid of the default theme.

:::



## Local 
 
```{r local, echo = TRUE}
#| code-line-numbers: "2,6,3,7,4,8,5,9"
#| output-location: column
ggplot() +
  geom_point(data = gapminder,
   aes(x = gdpPercap,
       y = lifeExp, 
       color = continent)) + 
  geom_smooth(data = gapminder,
   aes(x = gdpPercap, 
       y = lifeExp, 
      color = continent)) 
```






## Global 

```{r gapminder-global, echo = TRUE}
#| code-line-numbers: "1,2,3,4,5"
#| output-location: column
ggplot(gapminder,
       aes(x = gdpPercap,
          y = lifeExp, 
          color = continent))  + 
  geom_point() +
  geom_smooth() 

```




:::{.notes}
So we have mostly been working inside the individual geoms. However most people do not do this because it can start to get inconvenient quickly. If we work inside each individual geom than the other geom will not know what is going on and ggplot will get confused. 

Instead if you pass off our argument to the first layer that the aes argument will inheret the appropriate stuff

:::








## Building Plots
#### Starting with Data and aesthics 



```{r complex-plot-no-geoms-show,  echo = TRUE}
#| output-location: column
ggplot(gapminder,
 aes(x = gdpPercap,
    y = lifeExp))
```




:::{.notes}
So far we have only walked through geoms and aesthics but we need other layers to make graphs that make sense. And are presentable to professional audiences 

:::





##  Add `geom_point`

```{r complex-plot-add-geom-point-show,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "5"
ggplot(gapminder,
    aes(x = gdpPercap,
        y = lifeExp,
        color = continent)) +
  geom_point()
  
```







##  Add `geom_smooth`


```{r complex-plot-add-geom-smooth-show,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "6"
ggplot(gapminder,
    aes(x = gdpPercap,
       y = lifeExp,
       color = continent)) +
  geom_point() +
  geom_smooth()
```


##  Change Transparency 


```{r complex-plot-change-alpha,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "5"
ggplot(gapminder,
    aes(x = gdpPercap,
       y = lifeExp,
       color = continent)) +
  geom_point(alpha = 0.5) +
  geom_smooth()
```





## Adjust scales with `scale_x_log10`


```{r complex-plot-add-log-show, echo = TRUE}
#| output-location: column
#| code-line-numbers: "7"
ggplot(gapminder,
     aes(x = gdpPercap,
         y = lifeExp,
         color = continent)) +
  geom_point(alpha = 0.5) +
  geom_smooth() +
  scale_x_log10()
```








## Add axis labels and title with `labs`


```{r complex-plot-add-labs-out,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "8,9,10"
ggplot(gapminder,
      aes(x = gdpPercap,
          y = lifeExp,
          color = continent)) +
  geom_point(alpha = 0.5) +
  geom_smooth() +
  scale_x_log10() +
  labs(x = "GDP per cap",
       y = "Life Expectancy",
       title = "The Effect of GDP per cap on Life Expectancy")
```



:::{.notes}
Labs can handle a lot of arguments. there are individual functuions for the x label and y label and title. But make your like easier by just using labs. You can also modify the legend in labs but I have various success with that. I tend to modify the legend using guides or theme

:::

## Add viridis color scale


```{r complex-plot-add-viridis-show,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "11"
ggplot(gapminder,
      aes(x = gdpPercap,
          y = lifeExp,
          color = continent)) +
  geom_point(alpha = 0.5) +
  geom_smooth() +
  scale_x_log10() +
  labs(x = "GDP per cap",
       y = "Life Expectanty",
       title = "The Effect of GDP per cap on Life Expectancy") +
  scale_color_viridis_d()
```











## Add theme



```{r complex-plot-add-theme-show,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "12"
ggplot(gapminder,
      aes(x = gdpPercap,
         y = lifeExp,
         color = continent)) +
  geom_point(alpha = 0.5) +
  geom_smooth() +
  scale_x_log10() +
  labs(x = "GDP per cap",
       y = "Life Expectanty",
       title = "The Effect of GDP per cap on Life Expectancy") +
  scale_color_viridis_d() +
  theme_bw()
```









## Facet by Continent


```{r complex-plot-facet-show,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "13"
ggplot(gapminder,
    aes(x = gdpPercap,
        y = lifeExp,
        color = continent)) +
  geom_point(alpha = 0.5) +
  geom_smooth() +
  scale_x_log10() +
  labs(x = "GDP per cap",
      y = "Life Expectanty",
      title = "The Effect of GDP per cap on Life Expectancy") +
  scale_color_viridis_d() +
  theme_bw() +
  facet_wrap(vars(continent))
```




## Change Theme Options


```{r change-default-theme-option-complex-plot-show, echo = TRUE}
#| output-location: column
#| code-line-numbers: "14"
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent)) +
  geom_point(alpha = 0.5) +
  geom_smooth() +
  scale_x_log10() +
  labs(x = "GDP per cap",
      y = "Life Expectanty",
      title = "The Effect of GDP per cap on Life Expectancy") +
  scale_color_viridis_d() +
  theme_bw() +
  facet_wrap(vars(continent)) +
  theme(legend.position = "none")
```





## Scales

<table>
  <tr>
    <th class="cell-left">Example layer</th>
    <th class="cell-left">What it does</th>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_x_continuous()</code></td>
    <td class="cell-left">Make the x-axis continuous</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_x_continuous(breaks = 1:5)&ensp;</code></td>
    <td class="cell-left">Manually specify axis ticks</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_x_log10()</code></td>
    <td class="cell-left">Log the x-axis</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_color_gradient()</code></td>
    <td class="cell-left">Use a gradient</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_fill_viridis_d()</code></td>
    <td class="cell-left">Fill with discrete viridis colors</td>
  </tr>
</table>


:::{.notes}
Often time we need to or want to adjust the scales that one or more of the axis are on or we pass off color arguments to 
:::





## Scales in Action


```{r show-options-for-scales,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "9"
ggplot(gapminder,
  aes(x = gdpPercap,
      y = lifeExp,
      size = pop,
      color = continent)) +
  geom_point(alpha = 0.5) +
  labs(x = "Income",
     y = "Life Expectancy") +
  scale_x_log10(labels = scales::dollar) +
  theme_bw() 



```



:::{.notes}
Instead of directly transforming your data ggplot allows you to do this through the scale_x function which is pretty neat. I will not go through each of them but that is pretty handy. If you want nicer looking labels you can use the scales package to make nicer looking labels. I.e adding commas to values on the x or y axis adding the dollar sign or percentage sign etc

:::

# Scales in Action 

```{r }
#| output-location: column
#| code-line-numbers: "9,10,11,12"
ggplot(gapminder,
  aes(x = gdpPercap,
     y = lifeExp,
     size = pop,
    color = continent)) +
  geom_point(alpha = 0.5) +
  labs(x = "Income", y = "Life Expectancy") +
  scale_x_log10(labels = scales::dollar) +
  scale_color_manual(values = c("#04a3bd",
     "#f0be3d",
     "#931e18",
     "#da7901")) +
  theme_bw() 
```

:::{.notes}
If you want to use  a different set of colors you choose those manull
:::

## Scales in Action 


```{r}
#| output-location: column
#| code-line-numbers: "9,10,11,12"
ggplot(gapminder,
  aes(x = gdpPercap,
     y = lifeExp,
     size = pop,
    color = continent)) +
  geom_point(alpha = 0.5) +
  labs(x = "Income", y = "Life Expectancy") +
  scale_x_log10(labels = scales::dollar) +
  scale_color_met_d(name = "Veronese") +
  theme_bw() 


```


## Scales

The `scale_*()` components control the properties of all the<br><b class='simple-highlight-ylw'>aesthetic dimensions mapped to the data.</b>

<br>The extensions (`*`) can be filled by e.g.:

-   `continuous()`, `discrete()`, `reverse()`, `log10()`, `sqrt()`, `date()` for positions

-   `continuous()`, `discrete()`, `manual()`, `gradient()`, `gradient2()`, `brewer()` for colors

-   `continuous()`, `discrete()`, `manual()`, `ordinal()`, `area()`, `date()` for sizes

-   `continuous()`, `discrete()`, `manual()`, `ordinal()` for shapes

-   `continuous()`, `discrete()`, `manual()`, `ordinal()`, `date()` for transparency

------------------------------------------------------------------------

![Illustration by [Allison Horst](https://github.com/allisonhorst/stats-illustrations)](pics/continuous_discrete.png){fig-size="120%" fig-align="center" fig-alt="Allison Horsts illustration ofthe correct use of continuous versus discrete; however, in {ggplot2} these are interpeted in a different way: as quantitative and qualitative."}

## Continuous vs. Discrete in {ggplot2}

::: {layout-ncol="2"}
## Continuous:<br>quantitative or numerical data

-   height
-   weight
-   age
-   counts

## Discrete:<br>qualitative or categorical data

-   species
-   sex
-   study sites
-   age group
:::

## Continuous vs. Discrete in {ggplot2}

::: {layout-ncol="2"}
## Continuous:<br>quantitative or numerical data

-   height (continuous)
-   weight (continuous)
-   age (continuous or discrete)
-   counts (discrete)

## Discrete:<br>qualitative or categorical data

-   species (nominal)
-   sex (nominal)
-   study site (nominal or ordinal)
-   age group (ordinal)
:::


## Scales in Action 


```{r scale-x-continous-example, echo=TRUE}
#| code-line-numbers: "5"
#| output-location: column
ggplot(gapminder,
      aes(x = gdpPercap,
          y = lifeExp,
          size = pop,
          color = continent)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(limits = c(0, 30000)) +
  theme_bw()
 

```







:::{.notes}
In some cases you may want to change the coordinates of the plot to expand or contract the coordinates or in some cases just flip them without hassle. ggplot defaults to using coord_cartesian on its own but coord_cartesian can be used to zoom in on part of the plot. The coor_flip here is a bit silly but it is insanely useful for barcharts and other charts where you may have added things into aes and don't want to go back and redo it

:::

## Coordinate Systems

<br>

<b class='simple-highlight-grn' style='font-size:2.6rem;'>= interpret the position aesthetics</b><br><br>

::: incremental
-   **linear coordinate systems:** preserve the geometrical shapes
    -   `coord_cartesian()`
    -   `coord_fixed()`
    -   `coord_flip()`
-   **non-linear coordinate systems:** likely change the geometrical shapes
    -   `coord_polar()`
    -   `coord_map()` and `coord_sf()`
    -   `coord_trans()`
:::


## Change the Limits of the plot

```{r}
#| output-location: column
#| code-line-numbers: "6"
ggplot(gapminder,
    aes(x = gdpPercap,
     y = lifeExp)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(limits = c(0, 30000)) +
  theme_bw()

```



## Circular Coordinate Systems 

::: {layout-ncol="2"}
```{r}
#| fig-height: 3.9
#| code-line-numbers: "5"
ggplot(penguins,
 aes(x = species,
 fill = species)) +
geom_bar() + 
coord_polar()


```


::: fragment
```{r}
#| label: coord-cartesian-comp-polar
#| fig-height: 3.9
#| code-line-numbers: "5"
ggplot(penguins,
 aes(x = species,
  fill = species)) +
geom_bar() + 
coord_cartesian()
```
:::
:::

## Your Turn 
### Change the colors of this density plot


```{r fill-your-turn-option-example, echo = FALSE}
#| fig-align: center
#| fig-width: 8
ggplot(penguins, aes(x = bill_length_mm, fill = species)) +
  geom_density( alpha = 0.75) +
  theme_bw() +
  scale_fill_viridis_d(option = "magma")
 # scale_fill_manual(values = c(colors))
```

```{r fill-bill-length-options-timer, echo = FALSE}
countdown::countdown(minutes = 4)
```


:::{.notes}
look at the help file for scale_fill_viridis and play around with the options 

:::


## How I Did It



```{r changing-viridis-options-show,  echo = TRUE}
#| output-location: column

ggplot(penguins,
 aes(x = bill_length_mm,
    fill = species)) +
  geom_density( alpha = 0.75) +
  theme_bw() +
  scale_fill_viridis_d(option = "magma")

```







## Facets

<table>
  <tr>
    <th class="cell-left">Example layer</th>
    <th class="cell-left">What it does</th>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">facet_wrap(vars(continent))</code></td>
    <td class="cell-left">Plot for each continent</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">facet_wrap(vars(continent, year))</code>&emsp;</td>
    <td class="cell-left">Plot for each continent/year</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">facet_wrap(..., ncol = 1)</code></td>
    <td class="cell-left">Put all facets in one column</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">facet_wrap(..., nrow = 1)</code></td>
    <td class="cell-left">Put all facets in one row</td>
  </tr>
</table>






## facet_wrap


```{r facet-wrap-one-col, echo=TRUE}
#| output-location: column
#| code-line-numbers: "8"
ggplot(gapminder,
  aes(x = gdpPercap,
     y = lifeExp,
     size = pop)) +
  geom_point(alpha = 0.5) +
  theme_bw() +
  scale_x_log10() +
  facet_wrap(vars(continent)) 
  

```

:::{.notes}
If we want to get individual plots for each value of the variable we can feed this to facet wrap and is a really useful way of displaying information and saves you from creating subsets for each continent than plotting them individuall than combining them. You also have lots of 


:::



## facet_grid 

```{r}
#| output-location: column
#| code-line-numbers: "9"
ggplot(data = filter(gapminder,
 year %in% c(1987,1997,2002, 2007)),
    aes(x = gdpPercap,
     y = lifeExp,
     size = pop)) +
  geom_point(alpha = 0.5) +
  theme_bw() +
  scale_x_log10() +
  facet_grid(vars(year))
```

:::{.notes}
forms a matrix of panels defined by row and column faceting variables. It is most useful when you have two discrete variables, and all combinations of the variables exist in the data.

:::


## facet_grid


```{r}
#| output-location: column
#| code-line-numbers: "9"
ggplot(data = filter(gapminder,
 year %in% c(1987,1997,2002, 2007)),
    aes(x = gdpPercap,
     y = lifeExp,
     size = pop)) +
  geom_point(alpha = 0.5) +
  theme_bw() +
  scale_x_log10() +
  facet_grid(vars(year), vars(continent))
```






## Labels

<table>
  <tr>
    <th class="cell-left">Example layer</th>
    <th class="cell-left">What it does</th>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">labs(title = "Neat title")</code></td>
    <td class="cell-left">Title</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">labs(caption = "Something")</td>
    <td class="cell-left">Caption</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">labs(y = "Something")</td>
    <td class="cell-left">y-axis</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">labs(size = "Population")</code></td>
    <td class="cell-left">Title of size legend</td>
  </tr>
</table>







## Labels with labs 



```{r labels-example-show,  echo = TRUE}
#| output-location: column
#| code-line-numbers: "8,9,10,11,12,13,14"
ggplot(gapminder, 
       aes(x = gdpPercap,
        y = lifeExp, 
        color = continent,
        size = pop)) +
 geom_point(alpha = 0.5) +
  scale_x_log10() +
  labs(title = "Health and wealth grow together",
       subtitle = "Data from 2007",
       x = "Wealth (GDP per capita)",
       y = "Health (life expectancy)",
       color = "Continent",
       size = "Population",
       caption = "Source: The Gapminder Project")
```


:::{.notes}
The labs argument has a ton of flexibility. Basically if you feed something into aes you can change it in labs. I Tend to change legend labels in guides. That is just a personal preference but labs is superflexible. You will sometimes see other solutions for changing your legend.

:::


## Changing the Default Theme 

::::{.columns}
::: {.column width="45%"}

### theme_minimal

```{r theme-minimal-theme-out, echo = FALSE}

ggplot(gapminder, 
       aes(x = gdpPercap,
        y = lifeExp, 
           color = continent,
            size = pop)) +
  geom_point(alpha = 0.5) +
  scale_x_log10() +
  labs(title = "Health and wealth grow together",
       subtitle = "Data from 1952 to 2007",
       x = "Wealth (GDP per capita)",
       y = "Health (life expectancy)",
       color = "Continent",
       size = "Population",
       caption = "Source: The Gapminder Project") +
       theme_minimal()
```


:::


::: {.column width="45%"}

### theme_dark
```{r theme-dark-theme-out, echo = FALSE}

ggplot(gapminder, 
       aes(x = gdpPercap,
        y = lifeExp, 
           color = continent,
            size = pop)) +
  geom_point(alpha = 0.5) +
  scale_x_log10() +
  labs(title = "Health and wealth grow together",
       subtitle = "Data from 1952 to 2007",
       x = "Wealth (GDP per capita)",
       y = "Health (life expectancy)",
       color = "Continent",
       size = "Population",
       caption = "Source: The Gapminder Project") +
       theme_dark()
```

:::
::::



## The theme argument 

- Has lots and lots of options(94 to be exact)

- You can change basically anything you could think of in a plot
  - My ggplot theme is basically just a some tweaks to theme arguments


```{r show-theme-options, eval = FALSE, echo = TRUE}
theme_bw() + 
theme(legend.position = "bottom",
      plot.title = element_text(face = "bold"),
      axis.title.y = element_text(face = "italic"))
```






## Saving your work 

```{r fake-plot, eval = FALSE, echo = TRUE}
your_plot_here = ggplot(data, aes(x = blah, y = blah))
```
```{r ggsave-pdf, eval=FALSE, echo = TRUE}

ggsave("name-of-your-file.pdf",your_plot_here) 
```



```{r ggsave-examp-png, eval=FALSE, echo = TRUE}
ggsave("name-of-your-file.pngs",your_plot_here)
```




# Making Maps {background-color="`r clrs[3]`" .white}






## New Packages

```{r show-packagages-map, eval=FALSE, echo = TRUE}
install.packages(c("sf", "tidygeocoder"))
devtools::install_github("ropenscilabs/rnaturalearth")
library(rnaturalearth)
library(sf)

```

- If you are on a Mac please go to the [r-spatial-website](https://r-spatial.github.io/sf/) if you run into problems

- The workhorse for this particular section will be `sf`

:::aside

There are some other packages like geom_map and ggmap. They still work but sf(simple features) is really great and has a ton of support and resources. 
See [this book](https://geocompr.robinlovelace.net/)
:::


:::{.notes}
There are lots of mapping packages in R. I will only show you how to map in ggplot. You can get a really passable map in ggplot. I have included the code the Emre wrote that uses tmap. tmap is good and I have used it but once you get the hand of ggplot I think it is just easier to use ggplot than to learn how to use a new package

:::

## Mapping in R 

- R and ggplot can get you pretty far 

- The stuff from these workshops broadly apply 
  - including your dplyr verbs

- Lots of your needs to make *static* maps can be met

- Depending on what you are doing you may have to wait a bit




## Map Made By Kieran Healy 

```{r kieran-map, echo=FALSE}
knitr::include_graphics("https://raw.githubusercontent.com/andrewheiss/datavizs21.classes.andrewheiss.com/main/static/slides/img/12/streams-lakes-bw-100-w-01.jpg")
```






## Shape Files 

- To read in shape files you use `read_sf` you should see something that looks like this! 


```{r show-geometry,echo=FALSE}
placenames = read_sf("data/ME-GIS/Combined_Placenames.shp")

placenames |>
select(NAME, geometry) |>
filter(NAME %in% c("Hobbiton",
                     "Rivendell",
                     "Edoras",
                     "Minas Tirith", "Mordor")) |>
knitr::kable(format = "html")

```

:::{.notes}
When you download a shapefile you will get lots and lots of stuff. Lots of the shapefiles that you encounter in the wild are maintained by governments so keep those in the working directory. I will get to how to read in shape files in a minute. But when you read them into R the only thing that changes from your usual dataframe, tibble, data.table etc is that you will get a column in your dataset called geometry. This is just a list of things that delineate boundaries. for smaller countries like Fiji the number of boundaries are going to be smaller than say larger countries by area. It doesnt make sense to us but it makes sense to R 
:::




## Making Maps in ggplot


```{r basic-map,  echo = TRUE}
#| output-location: column
## devtools::install_github("ropenscilabs/rnaturalearth")
library(rnaturalearth)

world_map_ne = ne_states(returnclass = "sf")

ggplot() +
  geom_sf(data = world_map_ne)
```





:::{.notes}
as you can see nothing really fundamentally changes when you are making maps in ggplot. It is no different fundamentally than making a scatter plot or any other kind of plot here we are just feeding data to geom_sf 

:::

## Changing the Projections


```{r gall-peters-projection, echo = TRUE, cache = TRUE}
#| output-location: column
ggplot() +
  geom_sf(data = world_map_ne) + 
  coord_sf(crs = "+proj=cea +lon_0=0 +lat_ts=45") +
  theme_void()
```




:::{.notes}
You can really easily change the projections you want. Here we are just feeding it a different projections If you ever watched the west wing you may recognize this particular projection

:::



## Working Without Shape Files(kind of)

- As is the case sometimes we do not have a shape file


- Don't worry `sf` has you covered 

- You just need to feed it the right things




## Making a Bespoke Shapefile 

- You can either feed it latitude and longitudes 

- Or you can feed it addresses

- Most free ones have rate limits
  - So be mindful of the size of your data


:::{.notes}
In this case if we do not have the geometry column but we have some addresses we can just geocode them to produce the column.

:::


## Making a Bespoke Shapefile(cont)


```{r eval=FALSE, echo = TRUE}
ga_cities = tribble( 
  ~city, ~lat, ~long,
  "Atlanta", 33.748955, -84.388099,
  "Athens", 33.950794, -83.358884,
  "Savannah", 32.113192, -81.089350
)


ga_cities_geometry = ga_cities |>  
  st_as_sf(coords = c("long", "lat"), crs = st_crs("EPSG:4326"))
ga_cities_geometry

```


```{r echo=FALSE}
ga_cities = tribble( 
  ~city, ~lat, ~long,
  "Atlanta", 33.748955, -84.388099,
  "Athens", 33.950794, -83.358884,
  "Savannah", 32.113192, -81.089350
)


 ga_cities |> 
  st_as_sf(coords = c("long", "lat"), crs = st_crs("EPSG:4326")) |> 
  knitr::kable(format = "html") 
   
   
```








:::aside
examples derived from Andrew Heiss
:::




## Making a Bespoke Shapefile(cont)




```{r  cache=TRUE}
#| output-location: column
library(tidygeocoder)
breweries_I_visit = tribble(
  ~name, ~address,
  "Russian River Brewing", "725 4th St, Santa Rosa, CA 95404",
  "Orpheus Brewing", "1440 Dutch Valley Pl NE, Atlanta, GA 30324",
  "Three Tavens", "121 New St, Decatur, GA 30030",
  "HenHouse Brewing Company", "322 Bellevue Ave, Santa Rosa, CA 95407"
)


breweries_geocode = breweries_I_visit |> 
  geocode(address, method = "osm")

breweries_geocode |> 
  st_as_sf(coords = c("long", "lat"), crs = st_crs("EPSG:4326")) |> 
  knitr::kable(format = "html")
```


:::{.notes}
in the geocode argument you can cascade the services just in case it fails. The neat thing is that you can feed it a dataframe of addresses. What is also pretty cool is that it plays really well with other R tidyverse packages so if you scrape a website to grab a ton of addresses than you can just feed it into tidygeocoder 


from there you can use ggplot or even create interactive leaflet maps 

:::




## Mapping Middle Earth {.scrollable}

```{r echo = TRUE, warning = FALSE, message = FALSE, results = "hide" }
#| output-location: column
#| fig-height: 8 
# using some programming read in everything iteratively
# there is probably a simpler solution but this worked for me 
shapes <-  list.files(path = "data/ME-GIS/", pattern = "*.shp", full.names = TRUE)

shapes_read = map(shapes, read_sf)

remove <- c("data/ME-GIS//", ".shp", "2", "02", "_18", "")
#https://stackoverflow.com/questions/29036960/remove-multiple-patterns-from-text-vector-r
shapes_names = shapes |> 
  str_remove_all(paste(remove, collapse = "|")) |> 
  str_to_lower()

names(shapes_read) = shapes_names

map(names(shapes_read), ~assign(.x, shapes_read[[.x]], envir = .GlobalEnv))

places = placenames |>
  filter(NAME %in% c("Hobbiton",
                     "Rivendell",
                     "Edoras",
                     "Minas Tirith"))

mordor = placenames[placenames$NAME == "Mordor",]

mountains_to_label = mountains_anno[mountains_anno$name == "Erebor The Lonely Mountain",]


ggplot() +
  geom_sf(data = contours,
          size = 0.15,
          color = "grey90") +
  geom_sf(data = coastline,
          size = 0.25,
          color = "grey50") +
  geom_sf(data = rivers,
          size = 0.2,
          color = "#0776e0",
          alpha = 0.5) +
  geom_sf(data = lakes,
          size = 0.2,
          color = "#0776e0",
          fill = "#0776e0") +
  geom_sf(data = forests,
          size = 0,
          fill = "#035711",
          alpha = 0.5) +
  geom_sf(data = mountains_anno, size = 0.25) +
  geom_sf(data = places) +
  geom_sf_label(data = filter(places, NAME !="Rivendell"),
                aes(label = NAME),
                nudge_y = 80000, size = 6) +
  geom_sf_label(data = filter(places, NAME == "Rivendell"),
                aes(label = NAME),
                nudge_x = 88000, size = 6) +
  geom_sf_label(data = mountains_to_label,
                aes(label = name),
                nudge_y = 80000, size = 6) +
  geom_sf_label(data = mordor,
                aes(label = NAME),
                nudge_y = -10000, size = 6) +
  theme_void() +
  theme(plot.background = element_rect(fill = "#fffce3"))
```


:::{.notes}
As you can see this does not look fundamentally all that different from the rest of our ggplot code. We are just coloring and sizing ssutff depening on what we want. We can add annotations 
:::
